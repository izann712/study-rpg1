<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>StudyQuest</title>
<style>
  :root{
    --bg:#070709;
    --panel:#0f1113;
    --muted:#9aa3b2;
    --accent:#2f82f6; /* azul suave */
    --card:#121316;
    --tile-border:#202226;
    --btn:#2f6fe0;
    --btn-press:#2357b2;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8;font-family:Inter,Arial,Helvetica,sans-serif;-webkit-font-smoothing:antialiased}
  header{padding:14px 16px;background:linear-gradient(180deg,#0d0f11,#070709);border-bottom:1px solid rgba(255,255,255,0.02)}
  header h1{margin:0;font-size:18px}
  header .sub{margin-top:6px;color:var(--muted);font-size:13px}
  .app{padding:12px;padding-bottom:92px;max-width:920px;margin:0 auto}
  .card{background:linear-gradient(180deg,var(--panel), #0c0d0f);border-radius:12px;padding:12px;margin-bottom:12px;border:1px solid var(--tile-border)}
  .row{display:flex;gap:10px;align-items:center}
  .col{display:flex;flex-direction:column;gap:8px}
  .small{font-size:13px;color:var(--muted)}
  .big{font-weight:600;font-size:16px}
  .xpbar{height:12px;background:#060607;border-radius:10px;overflow:hidden;border:1px solid #0f1113}
  .xpbar > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent), #7dd3fc);width:0%;transition:width 600ms cubic-bezier(.2,.9,.3,1)}
  button.btn{display:inline-block;background:var(--btn);border:none;color:white;padding:10px 12px;border-radius:10px;font-size:15px;cursor:pointer}
  button.btn:active{background:var(--btn-press)}
  .muted{color:var(--muted)}
  ul.list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:10px}
  li.mission{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--tile-border);display:flex;justify-content:space-between;align-items:flex-start}
  .mission .meta{color:var(--muted);font-size:13px;margin-top:6px}
  .nav{position:fixed;left:0;right:0;bottom:0;height:72px;background:#09090b;border-top:1px solid #0f1113;display:flex;justify-content:space-around;align-items:center;padding:8px 6px;z-index:40}
  .nav button{background:none;border:none;color:var(--muted);font-size:13px;display:flex;flex-direction:column;align-items:center;gap:4px}
  .nav button.active{color:var(--accent)}
  .hidden{display:none}
  input[type="number"], input[type="text"]{width:100%;padding:10px;border-radius:8px;border:1px solid #222;background:#07080a;color:#fff}
  .badge{background:#0f1724;color:#9dd3ff;padding:6px 8px;border-radius:999px;font-weight:600}
  .muted-btn{background:transparent;border:1px solid #222;padding:8px 10px;border-radius:8px;color:var(--muted)}
  .section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .center{display:flex;justify-content:center;align-items:center}
  @media(min-width:720px){.app{padding:20px}}
</style>
</head>
<body>
  <header>
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h1>StudyQuest</h1>
        <div class="sub">Tu RPG de estudio ‚Äî 1¬∫ Bachillerato</div>
      </div>
      <div style="text-align:right">
        <div class="small">Nivel <span id="ui-level">1</span></div>
        <div class="small">ME <span id="ui-me">0</span></div>
      </div>
    </div>
  </header>

  <main class="app">
    <!-- MISI√ìNES -->
    <section id="sec-mis" class="card section">
      <div class="section-title"><h3 style="margin:0">Misiones diarias</h3>
        <div class="small">Hoy: <span id="ui-date">‚Äî</span></div>
      </div>
      <ul id="daily-list" class="list"></ul>

      <div style="height:12px"></div>
      <div class="section-title"><h3 style="margin:0">Misiones semanales</h3>
        <div class="small">Semana de: <span id="ui-weekstart">‚Äî</span></div>
      </div>
      <ul id="weekly-list" class="list"></ul>
    </section>

    <!-- PERSONAJE -->
    <section id="sec-char" class="card section hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Nivel</div>
          <div class="big" id="char-level">1</div>
        </div>
        <div style="flex:1;margin-left:12px">
          <div class="small">Progreso</div>
          <div class="xpbar" style="margin-top:6px"><i id="xp-fill" style="width:0%"></i></div>
          <div style="display:flex;justify-content:space-between;margin-top:6px">
            <div class="muted small">XP <span id="char-xp">0</span>/<span id="char-xpmax">100</span></div>
            <div class="muted small">ME <span id="char-me">0</span></div>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div class="row" style="gap:12px">
        <div style="flex:1"><div class="small">Fuerza mental</div><div class="big" id="stat-mental">5</div></div>
        <div style="flex:1"><div class="small">Disciplina</div><div class="big" id="stat-discipline">4</div></div>
        <div style="flex:1"><div class="small">Concentraci√≥n</div><div class="big" id="stat-focus">3</div></div>
      </div>

      <div style="height:12px"></div>
      <div class="row" style="gap:12px">
        <div style="flex:1"><div class="small">Creatividad</div><div class="big" id="stat-creativity">6</div></div>
        <div style="flex:1"><div class="small">Energ√≠a</div><div class="big" id="stat-energy">10</div></div>
      </div>
    </section>

    <!-- TIENDA -->
    <section id="sec-shop" class="card section hidden">
      <div class="section-title"><h3 style="margin:0">Tienda</h3><div class="small">ME disponibles: <span id="shop-me">0</span></div></div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="big">Poci√≥n de Enfoque</div>
            <div class="small">Efecto: +1 ME (inmediato)</div>
          </div>
          <div style="text-align:right">
            <div class="badge">10 ME</div>
            <div style="height:8px"></div>
            <button class="btn" onclick="buyItem('focus')">Comprar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="big">Snack energ√©tico</div>
            <div class="small">Efecto: +2 Energ√≠a</div>
          </div>
          <div style="text-align:right">
            <div class="badge">5 ME</div>
            <div style="height:8px"></div>
            <button class="btn" onclick="buyItem('snack')">Comprar</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="big">Caf√© del Erudito</div>
            <div class="small">Efecto: +1 Concentraci√≥n</div>
          </div>
          <div style="text-align:right">
            <div class="badge">8 ME</div>
            <div style="height:8px"></div>
            <button class="btn" onclick="buyItem('cafe')">Comprar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- EX√ÅMENES -->
    <section id="sec-exams" class="card section hidden">
      <div class="section-title"><h3 style="margin:0">Ex√°menes</h3>
        <div class="small">Introduce nota (0‚Äì10)</div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px;flex-wrap:wrap">
        <input id="exam-subject" placeholder="Asignatura (opcional)" type="text" style="flex:2;min-width:140px" />
        <input id="exam-grade" type="number" min="0" max="10" step="0.1" placeholder="Nota (0-10)" style="flex:1;min-width:90px" />
        <button class="btn" onclick="registerExam()">Registrar</button>
      </div>

      <div class="small muted">Historial de ex√°menes (los m√°s recientes arriba)</div>
      <ul id="exam-list" class="list" style="margin-top:10px"></ul>
    </section>

    <!-- LOGROS -->
    <section id="sec-logs" class="card section hidden">
      <h3 style="margin-top:0">Logros & Estad√≠sticas</h3>
      <div class="small">Misiones completadas totales: <span id="stat-total-missions">0</span></div>
      <div class="small">XP total acumulada: <span id="stat-total-xp">0</span></div>
      <div style="height:8px"></div>
      <div class="small">Ex√°menes registrados: <span id="stat-exams-count">0</span></div>
    </section>

  </main>

  <nav class="nav" aria-label="Navegaci√≥n">
    <button id="tab-mis" class="active" onclick="showTab('sec-mis', this)"><div>üèπ</div><div>Misiones</div></button>
    <button id="tab-char" onclick="showTab('sec-char', this)"><div>üßç</div><div>Personaje</div></button>
    <button id="tab-shop" onclick="showTab('sec-shop', this)"><div>üè™</div><div>Tienda</div></button>
    <button id="tab-ex" onclick="showTab('sec-exams', this)"><div>üìò</div><div>Ex√°menes</div></button>
    <button id="tab-log" onclick="showTab('sec-logs', this)"><div>üìä</div><div>Logros</div></button>
  </nav>

<script>
/* StudyQuest - single-file final
   - Dark elegant
   - Daily missions 1/day (2-3)
   - Weekly missions every Monday (3-4)
   - Full localStorage save (key 'sq_state_v2')
   - Exams history with XP/ME rewards per grade
   - No delete button, no day-sim
*/

// ---------- Base data ----------
const DAILY_BASE = [
  {name:"Revisi√≥n r√°pida de 15 min", xp:10, me:1},
  {name:"Orden del escritorio o mochila", xp:8, me:0},
  {name:"Hacer 5 ejercicios extra", xp:15, me:1},
  {name:"Leer 10 p√°ginas", xp:12, me:0},
  {name:"Mini-resumen de 5 l√≠neas", xp:12, me:0},
  {name:"Repasar apuntes", xp:10, me:0},
  {name:"Resolver dudas pendientes", xp:14, me:0},
  {name:"Preparar la agenda", xp:8, me:0},
  {name:"Repasar f√≥rmulas", xp:10, me:0},
  {name:"Leer un art√≠culo educativo", xp:12, me:0},
  {name:"Actividad de memoria", xp:10, me:0},
  {name:"Practicar problemas de c√°lculo", xp:15, me:0},
];

const WEEKLY_BASE = [
  {name:"Mejorar un trabajo", xp:25, me:2},
  {name:"Autoexamen 10 preguntas", xp:35, me:2},
  {name:"Mapa mental", xp:30, me:0},
  {name:"Res√∫menes de asignatura", xp:35, me:0},
  {name:"Estudiar 2 horas acumuladas", xp:50, me:0},
  {name:"Trabajo largo pendiente", xp:45, me:0},
  {name:"Revisi√≥n profunda de ex√°menes", xp:45, me:0},
];

// ---------- Storage ----------
const STORAGE_KEY = 'sq_state_v2';
let state = {
  level:1, xp:0, me:20,
  mental:5, discipline:4, focus:3, creativity:6, energy:10,
  dailyDate:null, dailyMissions:[],
  weeklyStart:null, weeklyMissions:[],
  totalMissionsCompleted:0, totalXpEarned:0,
  exams: []
};

function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){ console.error(e); } }
function loadState(){
  try{
    const s = localStorage.getItem(STORAGE_KEY);
    if(s) state = JSON.parse(s);
  }catch(e){ console.error('load error',e); }
}

// ---------- Helpers ----------
function todayStr(){ return new Date().toDateString(); }
function mondayStartISO(d = new Date()){
  const date = new Date(d);
  const day = date.getDay(); // 0 Sun .. 6
  const diff = (day === 0 ? -6 : 1) - day; // shift to monday
  date.setDate(date.getDate() + diff);
  date.setHours(0,0,0,0);
  return date.toISOString().slice(0,10); // YYYY-MM-DD
}
function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }
function sample(arr, n){
  const copy = arr.slice(); const out = []; n = Math.min(n, copy.length);
  for(let i=0;i<n;i++){ const idx = Math.floor(Math.random()*copy.length); out.push(copy[idx]); copy.splice(idx,1); }
  return out;
}

// ---------- XP / Level ----------
function xpNeededFor(l){
  if(l <= 20) return 100;
  if(l <= 50) return 150;
  if(l <= 80) return 200;
  return 225;
}
function addXp(amount){
  if(!amount || amount <= 0) return;
  state.xp += amount;
  state.totalXpEarned += amount;
  let leveled = false;
  while(state.level < 100 && state.xp >= xpNeededFor(state.level)){
    state.xp -= xpNeededFor(state.level);
    state.level++;
    state.energy = (state.energy||0) + 1;
    state.focus = (state.focus||0) + 1;
    leveled = true;
  }
  renderAll();
  saveState();
  if(leveled) toast('¬°Subiste a nivel ' + state.level + '!');
}

// ---------- Missions generation (S2: weekly Monday) ----------
function ensureWeekly(){
  const monday = mondayStartISO();
  if(state.weeklyStart !== monday || !state.weeklyMissions || state.weeklyMissions.length === 0){
    const count = Math.random() < 0.5 ? 3 : 4;
    const picks = sample(WEEKLY_BASE, count).map(m => ({...m, done:false}));
    state.weeklyMissions = picks;
    state.weeklyStart = monday;
    saveState();
  }
}
function ensureDaily(){
  const today = todayStr();
  if(state.dailyDate !== today || !state.dailyMissions || state.dailyMissions.length === 0){
    const count = Math.random() < 0.5 ? 2 : 3;
    const picks = sample(DAILY_BASE, count).map(m => ({...m, done:false}));
    state.dailyMissions = picks;
    state.dailyDate = today;
    saveState();
  }
}

// ---------- Render ----------
function renderAll(){
  // header quick
  document.getElementById('ui-level').textContent = state.level;
  document.getElementById('ui-me').textContent = state.me;
  document.getElementById('char-level').textContent = state.level;
  document.getElementById('char-xp').textContent = state.xp;
  document.getElementById('char-xpmax').textContent = xpNeededFor(state.level);
  document.getElementById('char-me').textContent = state.me;
  // xp bar
  const perc = Math.min(100, Math.round((state.xp / xpNeededFor(state.level)) * 100));
  document.getElementById('xp-fill').style.width = perc + '%';
  // stats
  document.getElementById('stat-mental').textContent = state.mental;
  document.getElementById('stat-discipline').textContent = state.discipline;
  document.getElementById('stat-focus').textContent = state.focus;
  document.getElementById('stat-creativity').textContent = state.creativity;
  document.getElementById('stat-energy').textContent = state.energy;
  // dates
  document.getElementById('ui-date').textContent = state.dailyDate || '‚Äî';
  document.getElementById('ui-weekstart').textContent = state.weeklyStart || '‚Äî';
  // lists
  const dl = document.getElementById('daily-list'); dl.innerHTML = '';
  (state.dailyMissions || []).forEach((m, idx) => {
    const li = document.createElement('li'); li.className='mission';
    li.innerHTML = `<div style="flex:1"><div class="big">${escapeHtml(m.name)}</div>
                    <div class="meta small">+${m.xp} XP ${m.me?('&nbsp;‚Ä¢&nbsp;+'+m.me+' ME'):''}</div></div>
                    <div style="margin-left:12px"><button class="btn" ${m.done?'disabled':''} onclick="completeDaily(${idx})">${m.done?'Completada':'Completar'}</button></div>`;
    dl.appendChild(li);
  });
  const wl = document.getElementById('weekly-list'); wl.innerHTML = '';
  (state.weeklyMissions || []).forEach((m, idx) => {
    const li = document.createElement('li'); li.className='mission';
    li.innerHTML = `<div style="flex:1"><div class="big">${escapeHtml(m.name)}</div>
                    <div class="meta small">+${m.xp} XP ${m.me?('&nbsp;‚Ä¢&nbsp;+'+m.me+' ME'):''}</div></div>
                    <div style="margin-left:12px"><button class="btn" ${m.done?'disabled':''} onclick="completeWeekly(${idx})">${m.done?'Completada':'Completar'}</button></div>`;
    wl.appendChild(li);
  });
  // exams
  const exlist = document.getElementById('exam-list'); exlist.innerHTML = '';
  (state.exams || []).slice().reverse().forEach(e => {
    const li = document.createElement('li'); li.className='mission';
    const subj = e.subject ? escapeHtml(e.subject) + ' ‚Äî ' : '';
    li.innerHTML = `<div style="flex:1"><div class="big">${subj}Nota: ${e.grade}</div>
                    <div class="meta small">${e.xp} XP ‚Ä¢ ${e.me} ME ‚Ä¢ ${new Date(e.date).toLocaleString()}</div></div>`;
    exlist.appendChild(li);
  });
  // logs
  document.getElementById('stat-total-missions').textContent = state.totalMissionsCompleted;
  document.getElementById('stat-total-xp').textContent = state.totalXpEarned;
  document.getElementById('stat-exams-count').textContent = state.exams.length;
  // shop
  document.getElementById('shop-me').textContent = state.me;
}
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

// ---------- Actions ----------
function completeDaily(i){
  const m = state.dailyMissions[i]; if(!m || m.done) return;
  m.done = true; state.totalMissionsCompleted++; state.me += m.me || 0;
  addXp(m.xp || 0); saveState(); renderAll();
}
function completeWeekly(i){
  const m = state.weeklyMissions[i]; if(!m || m.done) return;
  m.done = true; state.totalMissionsCompleted++; state.me += m.me || 0;
  addXp(m.xp || 0); saveState(); renderAll();
}

// ---------- Shop ----------
function buyItem(key){
  if(key === 'focus'){
    if(state.me < 10){ toast('No tienes ME suficientes'); return; }
    state.me -= 10; state.me += 1; toast('Poci√≥n usada: +1 ME');
  } else if(key === 'snack'){
    if(state.me < 5){ toast('No tienes ME suficientes'); return; }
    state.me -= 5; state.energy = (state.energy || 0) + 2; toast('Snack: +2 Energ√≠a');
  } else if(key === 'cafe'){
    if(state.me < 8){ toast('No tienes ME suficientes'); return; }
    state.me -= 8; state.focus = (state.focus || 0) + 1; toast('Caf√©: +1 Concentraci√≥n');
  }
  saveState(); renderAll();
}

// ---------- Exams: rewards mapping (user-described) ----------
function examRewards(grade){
  const g = Number(grade);
  if(g < 5) return {xp:10, me:0};
  if(g < 6) return {xp:20, me:1};
  if(g < 7) return {xp:30, me:1};
  if(g < 8) return {xp:40, me:2};
  if(g < 9) return {xp:50, me:3};
  if(g < 9.5) return {xp:65, me:4};
  return {xp:80, me:5};
}
function registerExam(){
  const subj = document.getElementById('exam-subject').value.trim();
  const gradeInput = document.getElementById('exam-grade').value;
  if(gradeInput === ''){ toast('Introduce una nota entre 0 y 10'); return; }
  const grade = Math.max(0, Math.min(10, parseFloat(gradeInput)));
  const reward = examRewards(grade);
  const rec = {subject: subj, grade: grade.toFixed(1), xp: reward.xp, me: reward.me, date: new Date().toISOString()};
  state.exams.push(rec);
  state.me += reward.me;
  addXp(reward.xp);
  saveState(); renderAll();
  toast(`Examen registrado: +${reward.xp} XP, +${reward.me} ME`);
  document.getElementById('exam-grade').value = '';
  document.getElementById('exam-subject').value = '';
}

// ---------- Small toast ----------
let toastTimer = null;
function toast(msg){
  const t = document.createElement('div');
  t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.bottom='88px';
  t.style.background='rgba(10,10,10,0.95)'; t.style.padding='10px 14px'; t.style.borderRadius='10px';
  t.style.color='white'; t.style.boxShadow='0 6px 18px rgba(0,0,0,0.5)'; t.style.zIndex=9999; t.textContent=msg;
  document.body.appendChild(t);
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{ t.remove(); toastTimer=null; }, 2400);
}

// ---------- Tabs ----------
function showTab(sectionId, btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(sectionId).classList.remove('hidden');
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

// ---------- Init ----------
function init(){
  loadState();
  ensureWeekly();
  ensureDaily();
  renderAll();
  showTab('sec-mis', document.getElementById('tab-mis'));
  // autosave every 5s
  setInterval(saveState, 5000);
}
init();

/* Notes:
 - Data kept in localStorage key 'sq_state_v2'
 - Daily missions: generated once per day (device local date)
 - Weekly missions: generated every Monday (week starting Monday)
 - No "reset data" option; to clear progress you must clear site data manually
*/
</script>
  <!-- ======================= -->
<!--     PWA + SERVICE WORKER -->
<!-- ======================= -->

<!-- Manifest incrustado dentro del propio HTML -->
<link rel="manifest" href="data:application/json,{
  &quot;name&quot;: &quot;StudyQuest&quot;,
  &quot;short_name&quot;: &quot;StudyQuest&quot;,
  &quot;start_url&quot;: &quot;.&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;background_color&quot;: &quot;#070709&quot;,
  &quot;theme_color&quot;: &quot;#070709&quot;,
  &quot;icons&quot;: [
    {
      &quot;src&quot;: &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAB70lEQVR4nO2bMU7DQBBFz1lAASRAAUkQBIkQBIkQBIkQBIkQBMkVwOtvYGylR29UZ3uZE6V9yjvDXqj5WbGwUZvcCByA/xfUw3sALATfN4fZ9Glj9ogAhpsmx8OHHLdPG0v7T3kB4Z8QIEQIEQIEQIEQIEQIOQhQF2kAmTgPsvw+Px6PPb7fb7cYLwIzXMQcJr1dd12yTTNOy7J5Go1EU1XNvtevtbIsy7LMuy7KMfZ9NptNs12yTTPMcp9M0z06n2w22x0Oh2zXW63WCxWOBwOKRSKUykUilUpVKpVIpFIpFKZTIZDKZzOZzGYzmcxmMwG63W6zWazWbDb7TaDQaDQarVaDQaDQa/X63WC7XaLfb7XZbNZrNZrPZbNZrNZrPZbBYDAYDAYDAcDgcjn8/x+Hx2Gw2Gw2Gy2Ww2Ww2m80m83mcxmMwGk8nk8nk8nq9VqtVqtVovFYrFYrFYrFYrFYrFYrFY/D4/H4/H4/H49Go9Ho9Gk8nk8nk8nk8nk8nk8vk8vk8v0J+AS6of2qN5LKtAAAAAElFTkSuQmCC&quot;,
      &quot;sizes&quot;: &quot;128x128&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    }
  ]
}">

<script>
/* SERVICE WORKER INLINE GENERATOR */
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'sq-cache-v1';
    self.addEventListener('install', e => {
      e.waitUntil(
        caches.open(CACHE).then(c => c.addAll(['./']))
      );
    });
    self.addEventListener('fetch', e => {
      e.respondWith(
        caches.match(e.request).then(res => res || fetch(e.request))
      );
    });
  `;
  const blob = new Blob([swCode], {type:'application/javascript'});
  const swUrl = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swUrl).catch(err => console.error('SW error', err));
}
</script>

</body>
</html>
